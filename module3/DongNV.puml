@startuml
actor "PM" as U

participant "UI" as UI
participant "Authorization Service"
participant "Task Management Service" as System
participant "Database" as DB
participant "Notification Service"

U -> UI: Chọn nhiệm vụ và yêu cầu đóng
activate UI

UI -> "Authorization Service": Kiểm tra quyền đóng nhiệm vụ
activate "Authorization Service"

"Authorization Service" --> UI: Quyền hợp lệ
deactivate "Authorization Service"

UI -> System: Xử lý yêu cầu đóng nhiệm vụ
activate System

System -> DB: Kiểm tra điều kiện đóng nhiệm vụ
activate DB

alt Đủ điều kiện đóng
    DB --> System: Đạt điều kiện đóng
    System -> UI: Hiển thị hộp thoại xác nhận
    UI -> U: Xác nhận đóng nhiệm vụ
    U -> UI: Xác nhận đồng ý

    UI -> System: Thực hiện đóng nhiệm vụ
    System -> DB: Cập nhật trạng thái nhiệm vụ thành "Đã đóng"
    DB --> System: Cập nhật thành công
    deactivate DB

    System --> UI: Hiển thị xác nhận đóng nhiệm vụ
    deactivate System
    UI --> U: Xác nhận nhiệm vụ đã đóng

    UI -> "Notification Service": Gửi thông báo cập nhật
    activate "Notification Service"
    "Notification Service" --> U: Nhận thông báo nhiệm vụ đã đóng
    deactivate "Notification Service"

else Chưa đủ điều kiện đóng
    DB --> System: Trả về lý do từ chối
    deactivate DB

    System --> UI: Hiển thị cảnh báo điều kiện chưa đạt
    deactivate System
    UI --> U: Thông báo từ chối và hướng dẫn xử lý

end

@enduml
